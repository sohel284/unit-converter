{% extends 'base.html' %}
{% block 'content' %}
{% if conversion %}
<h2 class="pb-1 my-3">Convert <span class="unit">{{conversion.from_unit.name}}</span> to <span class="unit">{{conversion.to_unit.name}}</span>    </h2>
<div class="row">
    <div class="col-md-6">
        <div class="unit-input">
            <div class="input-group">
                <input type="text" class="form-control unit-input" value="1" aria-describedby="basic-addon2" 
                    data-rate="{{conversion.rate}}" 
                    id="input-{{conversion.from_unit.symbol_name}}" 
                    data-tounit="{{conversion.to_unit.symbol_name}}" 
                    onkeyup="onKeyUp(this)" />
                <div class="input-group-append">
                  <span class="input-group-text" id="basic-addon2">{{conversion.from_unit.symbol_name}}</span>
                </div>
            </div>
        </div>
        <label class="text-uppercase pt-1">=</label>
        <div class="unit-input">
            <div class="input-group">
                <input type="text" class="form-control unit-input" value="{{conversion.rate}}" 
                    aria-describedby="basic-addon3" 
                    data-rate="{{ conversion.inverse_rate }}"
                    id="input-{{conversion.to_unit.symbol_name}}" 
                    data-tounit="{{conversion.from_unit.symbol_name}}" 
                    onkeyup="onKeyUp(this)" />
                <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon3">{{conversion.to_unit.symbol_name}}</span>
                </div>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col">
                <button type="button" class="btn btn-success w-100 swap">Swap</button>
            </div>
        </div>
    </div>
</div>
<p>&nbsp;</p>
<div class="">
    <h5>{{conversion.from_unit.name}}</h5>
    <p>{{conversion.from_unit.description}}</p>
    <p>Read more at <a href="{{ conversion.from_unit.wiki_link }}">Wikipedia</a></p>
</div>

<div class="">
    <h5>{{conversion.to_unit.name}}</h5>
    <p>{{conversion.to_unit.description}}</p>
    <p>Read more at <a href="{{ conversion.to_unit.wiki_link }}">Wikipedia</a></p>
</div>
{% endif %}
{% endblock %}
{% block 'extra_js' %}
<script type="text/javascript">
    $.fn.swap = function (elem) {
        elem = elem.jquery ? elem : $(elem);
        return this.each(function () {
            $(document.createTextNode('')).insertBefore(this).before(elem.before(this)).remove();
        });
    };

    function onKeyUp(el) {
        var inputEl = $(el);      

        var inputVal = parseFloat(inputEl.val());
        var outputSelector = '#input-'+inputEl.data()['tounit'];

        if(!Number.isNaN(inputVal)) {
            var rate = parseFloat(inputEl.data()['rate']);
            var toUnit = inputEl.data()['tounit'];
            var result = inputVal * rate;
            $(outputSelector).val(result);
        } else {
            $(outputSelector).val('');
        }
    }

    $(document).ready(function() {
        $('button.swap').click(function() {
            // swap title names
            var unitTitles = $('span.unit');
            var tempLabel = $(unitTitles[0]).text();
            $(unitTitles[0]).text($(unitTitles[1]).text());
            $(unitTitles[1]).text(tempLabel);

            // swap input fields
            var unitInputDivs = $('div.unit-input');
            var inputGroup1 = $(unitInputDivs[0]).find('div.input-group').clone();
            var inputGroup2 = $(unitInputDivs[1]).find('div.input-group').clone();
            
            $('div.input-group').remove();
            $(unitInputDivs[0]).append(inputGroup2);
            $(unitInputDivs[1]).append(inputGroup1); 
        });
    });
</script>
{% endblock %}